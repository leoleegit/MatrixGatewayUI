(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[164],{54083:function(se){se.exports={main:"main___3cxVk",treeSearchValue:"treeSearchValue___1accA",tableBorder:"tableBorder___3__q0"}},61264:function(se,ae,n){"use strict";n.r(ae),n.d(ae,{default:function(){return Ae}});var He=n(13062),R=n(71230),Be=n(89032),j=n(15746),Me=n(32157),me=n(87524),Ge=n(58024),ie=n(39144),Ye=n(49111),Q=n(19650),ze=n(57663),P=n(71577),Je=n(34792),T=n(48086),We=n(71194),le=n(5644),Qe=n(9715),S=n(82482),E=n(2824),X=n(3182),u=n(8870),Xe=n(47673),$=n(4107),Ze=n(94043),F=n.n(Ze),y=n(67294),pe=n(70844),we=n(43358),de=n(90290),e=n(85893),C=de.Z.Option,xe=function(a){var d=a.parentCode,f=a.onSubmit,h=a.status,t=a.del,A=a.formRef,Z={INIT:"INIT",ADD:"ADD",EDIT:"EDIT",FUNCTION:"FUNCTION"},p=Z.INIT,B=Z.EDIT,K=Z.FUNCTION;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(R.Z,{children:(0,e.jsx)(j.Z,{span:24,children:(0,e.jsxs)(S.Z,{form:A,layout:"vertical",hideRequiredMark:!0,onFinish:f,children:[(0,e.jsx)(R.Z,{gutter:16,children:(0,e.jsxs)(j.Z,{span:12,children:[(0,e.jsx)(S.Z.Item,{name:"rootId",label:"Parent Node",children:(0,e.jsx)($.Z,{disabled:!0})}),(0,e.jsx)(S.Z.Item,{hidden:!0,name:"id",children:(0,e.jsx)($.Z,{disabled:!0})})]})}),(0,e.jsxs)(R.Z,{gutter:16,children:[(0,e.jsx)(j.Z,{span:12,children:(0,e.jsx)(S.Z.Item,{name:"code",label:"Permission Code",rules:[{required:!0,message:"Please enter permission code"}],children:(0,e.jsx)($.Z,{placeholder:"Permission code",disabled:h===p,addonBefore:d})})}),(0,e.jsx)(j.Z,{span:12,children:(0,e.jsx)(S.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter permission name"}],children:(0,e.jsx)($.Z,{placeholder:"Permission name",disabled:h===p})})})]}),(0,e.jsxs)(R.Z,{gutter:16,children:[(0,e.jsx)(j.Z,{span:12,children:(0,e.jsx)(S.Z.Item,{name:"path",label:"Path",children:(0,e.jsx)($.Z,{placeholder:"Permission path",disabled:h===p})})}),(0,e.jsx)(j.Z,{span:12,children:(0,e.jsx)(S.Z.Item,{name:"method",label:"Method",children:(0,e.jsxs)(de.Z,{disabled:h===p,children:[(0,e.jsx)(C,{selected:!0,value:"ALL",children:"ALL"}),(0,e.jsx)(C,{value:"GET",children:"GET"}),(0,e.jsx)(C,{value:"POST",children:"POST"}),(0,e.jsx)(C,{value:"HEAD",children:"HEAD"}),(0,e.jsx)(C,{value:"PUT",children:"PUT"}),(0,e.jsx)(C,{value:"PATCH",children:"PATCH"}),(0,e.jsx)(C,{value:"DELETE",children:"DELETE"}),(0,e.jsx)(C,{value:"OPTIONS",children:"OPTIONS"}),(0,e.jsx)(C,{value:"TRACE",children:"TRACE"})]})})})]}),(0,e.jsx)(R.Z,{gutter:16,children:(0,e.jsx)(j.Z,{span:24,children:(0,e.jsx)(S.Z.Item,{name:"desc",label:"Description",rules:[{required:!0,message:"please enter permission description"}],children:(0,e.jsx)($.Z.TextArea,{rows:2,placeholder:"Permission description",disabled:h===p})})})}),(0,e.jsx)(R.Z,{gutter:16,hidden:h===K,children:(0,e.jsx)(j.Z,{span:24,children:(0,e.jsxs)(Q.Z,{children:[h!==p&&(0,e.jsx)(P.Z,{onClick:function(){A.submit()},type:"primary",children:"Submit"}),h===B&&(0,e.jsx)(P.Z,{onClick:t,type:"danger",children:"Delete"})]})})})]})})})})},ue=xe,qe=n(57338),Ie=n(25084),oe=n(49101),je=n(86353),Te=n(20851),O=n(2442),Se=function(a){var d=a.rootId,f=a.parentCode,h=a.actionRef,t=a.className,A=a.status,Z={INIT:"INIT",ADD:"ADD",EDIT:"EDIT"},p=Z.EDIT,B=(0,y.useState)(void 0),K=(0,E.Z)(B,2),M=K[0],g=K[1],w=(0,y.useState)(void 0),q=(0,E.Z)(w,2),G=q[0],_=q[1],Y=S.Z.useForm(),te=(0,E.Z)(Y,1),N=te[0],z=le.Z.confirm,V=function(v){_(v);var l=v.code;l&&l.indexOf(":")!==-1&&(l=l.substring(l.lastIndexOf(":")+1,l.length)),N.setFieldsValue((0,u.Z)((0,u.Z)({},v),{},{code:l})),g(!0)},ne=[{title:"id",dataIndex:"id",key:"id",hideInSearch:!0,hideInTable:!0},{title:"Name",dataIndex:"name",key:"name"},{title:"Code",dataIndex:"code",key:"code",hideInSearch:!0},{title:"Method",dataIndex:"method",key:"method",hideInSearch:!0,filters:!0,onFilter:!0,valueType:"select",valueEnum:{ALL:{text:"ALL"},GET:{text:"GET"},POST:{text:"POST"},HEAD:{text:"HEAD"},PUT:{text:"PUT"},PATCH:{text:"PATCH"},DELETE:{text:"DELETE"},OPTIONS:{text:"OPTIONS"},TRACE:{text:"TRACE"}}},{title:"Path",dataIndex:"path",key:"path",hideInSearch:!0,ellipsis:!0},{title:"Action",valueType:"option",render:function(v,l,I,re){return(0,e.jsx)(Q.Z,{size:"middle",children:(0,e.jsx)("a",{onClick:function(){V(l)},children:"edit"})})}}],ee=function(){var x=(0,X.Z)(F().mark(function v(l,I,re){var b,U,J,L;return F().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!d){o.next=15;break}return b=l,I&&(U=Object.keys(I)[0],J=Object.values(I)[0],U&&J&&(b=(0,u.Z)((0,u.Z)({},b),{},{sortField:U,sort:J==="ascend"?"asc":"desc"}))),o.prev=3,o.next=6,(0,O.Pu)((0,u.Z)((0,u.Z)({},b),{},{rootId:d}));case 6:if(L=o.sent,L.code!==200){o.next=10;break}if(!L.results){o.next=10;break}return o.abrupt("return",{data:L.results,success:!0,total:L.count});case 10:o.next=15;break;case 12:return o.prev=12,o.t0=o.catch(3),o.abrupt("return",{});case 15:return o.abrupt("return",{data:[],success:!0,total:0});case 16:case"end":return o.stop()}},v,null,[[3,12]])}));return function(l,I,re){return x.apply(this,arguments)}}(),H=function(v){var l=v.id?O.kY:O.o5;l((0,u.Z)((0,u.Z)({},v),{},{code:"".concat(f,":").concat(v.code)})).then(function(I){I.code===200?T.default.success("Add Function Successful"):T.default.error("Add Function Failure"),h.current.reload(),g(!1)})},k=function(){var v=G.id;v&&z({title:"Delete Function",content:(0,e.jsx)(e.Fragment,{children:"Please confirm delete action"}),okText:"Confirm",onOk:function(){(0,O.g1)({id:v}).then(function(I){I.code===200?T.default.success("Delete Function Successful"):T.default.error("Delete Function Failure"),h.current.reload(),g(!1)})}})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Te.ZP,{className:t,style:{display:A===p?"block":"none"},headerTitle:"Function List",actionRef:h,rowKey:"id",search:!1,toolBarRender:function(){return[(0,e.jsxs)(P.Z,{type:"primary",hidden:!d,onClick:function(){_(void 0),N.resetFields(),N.setFieldsValue({rootId:d}),g(!0)},children:[(0,e.jsx)(oe.Z,{})," ",(0,e.jsx)(je._H,{id:"pages.userManage.new",defaultMessage:"New"})]},"primary")]},options:!1,request:ee,columns:ne}),(0,e.jsx)(Ie.Z,{visible:M,title:"Edit Function",width:720,onClose:function(){g(!1)},bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)(Q.Z,{children:[(0,e.jsx)(P.Z,{onClick:function(){g(!1)},children:"Cancel"}),(0,e.jsx)(P.Z,{onClick:function(){N.submit()},type:"primary",children:"Submit"}),G&&(0,e.jsx)(P.Z,{onClick:k,type:"danger",children:"Delete"})]}),closable:!1,maskClosable:!1,destroyOnClose:!0,children:(0,e.jsx)(ue,{formRef:N,onSubmit:H,status:"FUNCTION",parentCode:"".concat(f,":"),del:k})})]})},Ee=Se,ye=n(8212),De=n(54083),ce=n.n(De),ge=$.Z.Search,Ce=function D(a){if(a.children){var d=[];return a.children.forEach(function(f){d.push(D(f))}),(0,u.Z)((0,u.Z)({},a),{},{key:a.id,title:a.name,children:d})}return(0,u.Z)((0,u.Z)({},a),{},{key:a.id,title:a.name})},fe=function(){var D=(0,X.Z)(F().mark(function a(){var d,f;return F().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,O.Lw)({});case 3:if(d=t.sent,d.code!==200){t.next=10;break}if(!d.results){t.next=9;break}return f=[],d.results.forEach(function(A){f.push(Ce(A))}),t.abrupt("return",f);case 9:return t.abrupt("return",[]);case 10:t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",[]);case 15:return t.abrupt("return",[]);case 16:case"end":return t.stop()}},a,null,[[0,12]])}));return function(){return D.apply(this,arguments)}}(),Pe=function(){var D=(0,X.Z)(F().mark(function a(d){var f;return F().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,O.J$)(d);case 3:return f=t.sent,t.abrupt("return",f);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{});case 10:case"end":return t.stop()}},a,null,[[0,7]])}));return function(d){return D.apply(this,arguments)}}(),Fe=function(){var D=(0,X.Z)(F().mark(function a(d){var f;return F().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,O.kY)(d);case 3:return f=t.sent,t.abrupt("return",f);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{});case 10:case"end":return t.stop()}},a,null,[[0,7]])}));return function(d){return D.apply(this,arguments)}}(),Oe=function(){var a={INIT:"INIT",ADD:"ADD",EDIT:"EDIT"},d=a.INIT,f=a.ADD,h=a.EDIT,t=S.Z.useForm(),A=(0,E.Z)(t,1),Z=A[0],p=(0,y.useRef)(),B=le.Z.confirm,K=(0,y.useState)([]),M=(0,E.Z)(K,2),g=M[0],w=M[1],q=(0,y.useState)([]),G=(0,E.Z)(q,2),_=G[0],Y=G[1],te=(0,y.useState)(),N=(0,E.Z)(te,2),z=N[0],V=N[1],ne=(0,y.useState)(d),ee=(0,E.Z)(ne,2),H=ee[0],k=ee[1],x=(0,y.useState)(void 0),v=(0,E.Z)(x,2),l=v[0],I=v[1],re=(0,y.useState)(""),b=(0,E.Z)(re,2),U=b[0],J=b[1],L=function c(s,r){s.push(r.key),r.children&&r.children.forEach(function(i){c(s,i)})},he=function c(s,r){var i;return r.forEach(function(m){m.children&&(m.children.some(function(W){return W.key===s})?i=m.key:c(s,m.children)&&(i=c(s,m.children)))}),i},o=function(){k(d),V(void 0),Z.resetFields(),fe().then(function(s){w(s);var r=[];s.forEach(function(i){L(r,i)}),Y(r)})};(0,y.useLayoutEffect)(function(){fe().then(function(c){c.length>0&&w(c);var s=[];c.forEach(function(r){L(s,r)}),Y(s)})},[d]);var Ne=function(){if(k(f),l){var s=l.id,r=l.code;Z.resetFields(),s&&(Z.setFieldsValue({rootId:s}),V("".concat(r,":")))}},be=function(){if(k(h),l){var s,r=l.code;r&&r.indexOf(":")!==-1&&(s=r.substring(0,r.lastIndexOf(":")+1),r=r.substring(r.lastIndexOf(":")+1,r.length)),V(s),Z.setFieldsValue((0,u.Z)((0,u.Z)({},l),{},{code:r})),p.current.reload()}},ve=function(s){if(I(s),k(d),s){var r,i=s.code;i&&i.indexOf(":")!==-1&&(r=i.substring(0,i.lastIndexOf(":")+1),i=i.substring(i.lastIndexOf(":")+1,i.length)),V(r),Z.setFieldsValue((0,u.Z)((0,u.Z)({},s),{},{code:i}))}else V(void 0),Z.resetFields()},Le=function(){var s=Z.getFieldsValue(),r=s.id;r&&B({title:"Delete Permission",content:(0,e.jsx)(e.Fragment,{children:"Please confirm delete action"}),okText:"Confirm",onOk:function(){(0,O.g1)({id:r}).then(function(m){m.code===200?T.default.success("Delete Permission Successful"):T.default.error("Delete Permission Failure"),o()})}})},Re=function(s){return H===f?Pe((0,u.Z)((0,u.Z)({},s),{},{code:"".concat(z||"").concat(s.code)})).then(function(r){r.code===200?T.default.success("Add Permission Successful"):T.default.error("Add Permission Failure"),o()}):H===h&&Fe((0,u.Z)((0,u.Z)({},s),{},{code:"".concat(z||"").concat(s.code)})).then(function(r){r.code===200?T.default.success("Update Permission Successful"):T.default.error("Update Permission Failure"),o()}),!1},$e=function c(s,r,i){if(i.title.toLocaleLowerCase().indexOf(r)>-1){var m=he(i.key,g);m&&s.push(m)}i.children&&i.children.forEach(function(W){c(s,r,W)})},Ve=function(s){var r=s.target.value,i=[];g.forEach(function(m){$e(i,r.toLocaleLowerCase(),m)}),Y(i),J(r)},ke=function c(s){return s.map(function(r){var i=r.title.toLocaleLowerCase().indexOf(U.toLocaleLowerCase()),m=i>-1?function(){var W=r.title.substr(0,i),Ue=r.title.substr(i+U.length),Ke=r.title.substring(i,i+U.length);return(0,e.jsxs)("span",{children:[W,(0,e.jsx)("span",{className:ce().treeSearchValue,children:Ke}),Ue]})}:function(){return(0,e.jsx)("span",{children:r.title})};return r.children?(0,u.Z)((0,u.Z)({},r),{},{title:m,children:c(r.children)}):(0,u.Z)((0,u.Z)({},r),{},{title:m})})};return(0,e.jsxs)(pe.ZP,{children:[(0,e.jsx)(ie.Z,{children:(0,e.jsxs)(Q.Z,{children:[(0,e.jsxs)(P.Z,{type:"primary",onClick:Ne,children:[(0,e.jsx)(oe.Z,{}),"Add"]}),(0,e.jsxs)(P.Z,{onClick:be,disabled:!l,children:[(0,e.jsx)(ye.Z,{}),"Edit"]})]})}),(0,e.jsx)(ie.Z,{children:(0,e.jsxs)(R.Z,{gutter:24,children:[(0,e.jsxs)(j.Z,{span:8,children:[(0,e.jsx)(ge,{style:{marginBottom:8},placeholder:"Search",onChange:Ve}),(0,e.jsx)(me.Z,{showLine:!0,treeData:ke(g),expandedKeys:_,autoExpandParent:!0,onSelect:function(s,r){r.selected?ve(r.node):ve(void 0)}})]}),(0,e.jsxs)(j.Z,{span:16,children:[(0,e.jsx)(ue,{del:Le,parentCode:z,onSubmit:Re,status:H,formRef:Z}),(0,e.jsx)(Ee,{actionRef:p,className:ce().tableBorder,rootId:l==null?void 0:l.id,parentCode:l==null?void 0:l.code,status:H})]})]})})]})},Ae=Oe}}]);
