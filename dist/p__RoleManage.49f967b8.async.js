(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[597],{416:function(B){B.exports={main:"main___27Qvg",treeSearchValue:"treeSearchValue___3qwWj",tableBorder:"tableBorder___MFgVb"}},19693:function(B,$,n){"use strict";n.r($),n.d($,{default:function(){return be}});var Ge=n(58024),H=n(39144),We=n(49111),L=n(19650),Qe=n(57663),x=n(71577),Je=n(34792),y=n(48086),Xe=n(71194),ne=n(5644),c=n(8870),se=n(69610),re=n(54941),ie=n(81306),le=n(19809),F=n(3182),de=n(94043),A=n.n(de),Z=n(67294),oe=n(49101),ue=n(70844),qe=n(66456),ce=n(55178),fe=n(30381),he=n.n(fe),t=n(85893),ve=function(e){var o=[{title:"Name",dataIndex:"name",key:"name"},{title:"Code",dataIndex:"code",key:"code"},{title:"Description",dataIndex:"desc",key:"desc"},{title:"Updated At",dataIndex:"updatedAt",key:"updatedAt",valueType:"dateTime",render:function(m,s){return(0,t.jsx)(t.Fragment,{children:new(he())(new Date(s.updatedAt)).format("YYYY-MM-DD HH:mm")})}},{title:"Action",key:"Action",render:function(m,s){return(0,t.jsxs)(L.Z,{size:"middle",children:[(0,t.jsx)("a",{onClick:function(){e.edit(s)},children:"Edit"}),(0,t.jsx)("a",{onClick:function(){e.assignPermission(s)},children:"Assign Permission"})]})}}];return(0,t.jsx)(ce.Z,{rowKey:"id",columns:o,dataSource:e.dataSource,pagination:e.pagination,loading:e.loading,onChange:e.handleTableChange})},me=ve,_e=n(57338),Y=n(25084),et=n(13062),O=n(71230),tt=n(89032),T=n(15746),at=n(9715),E=n(82482),nt=n(47673),p=n(4107),ge=function(e){var o=function(){e.setShowAdd(!1)};return(0,t.jsx)(Y.Z,{visible:e.visible,title:"Role",width:720,onClose:function(){e.setShowAdd(!1)},bodyStyle:{paddingBottom:80},footer:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(x.Z,{onClick:o,children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:function(){document.getElementById("form-id").click()},type:"primary",children:"Submit"}),e.drawerData.id&&(0,t.jsx)(x.Z,{onClick:function(){e.delete(e.drawerData.id)},type:"danger",children:"Delete"})]}),closable:!1,maskClosable:!1,destroyOnClose:!0,children:(0,t.jsxs)(E.Z,{initialValues:e.drawerData,layout:"vertical",hideRequiredMark:!0,onFinish:e.onSubmit,children:[(0,t.jsxs)(O.Z,{gutter:16,children:[(0,t.jsx)(T.Z,{span:12,children:(0,t.jsx)(E.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter role name"}],children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.name,placeholder:"Please enter role name"})})}),(0,t.jsx)(T.Z,{span:12,children:(0,t.jsx)(E.Z.Item,{name:"code",label:"Role Code",rules:[{required:!0,message:"Please enter role code"}],children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.code,placeholder:"Please enter role code",disabled:!!e.drawerData.code})})})]}),(0,t.jsx)(O.Z,{gutter:16,children:(0,t.jsx)(T.Z,{span:24,children:(0,t.jsx)(E.Z.Item,{name:"desc",label:"Description",rules:[{required:!0,message:"please enter role description"}],children:(0,t.jsx)(p.Z.TextArea,{rows:2,defaultValue:e.drawerData.desc,placeholder:"please enter role description"})})})}),(0,t.jsx)(E.Z.Item,{name:"id",children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.id,style:{display:"none"}})}),(0,t.jsx)(x.Z,{id:"form-id",type:"primary",htmlType:"submit",style:{display:"none"},children:"Submit"})]})})},ye=ge,st=n(32157),Se=n(87524),I=n(2824),Ze=n(20851),P=n(2442),Pe=n(416),z=n.n(Pe),Ce=p.Z.Search,xe=function S(e){if(e.children){var o=[];return e.children.forEach(function(a){o.push(S(a))}),(0,c.Z)((0,c.Z)({},e),{},{key:e.id,title:e.name,children:o})}return(0,c.Z)((0,c.Z)({},e),{},{key:e.id,title:e.name})},je=function(){var S=(0,F.Z)(A().mark(function e(){var o,a;return A().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,P.Lw)({});case 3:if(o=s.sent,o.code!==200){s.next=10;break}if(!o.results){s.next=9;break}return a=[],o.results.forEach(function(g){a.push(xe(g))}),s.abrupt("return",a);case 9:return s.abrupt("return",[]);case 10:s.next=15;break;case 12:return s.prev=12,s.t0=s.catch(0),s.abrupt("return",[]);case 15:return s.abrupt("return",[]);case 16:case"end":return s.stop()}},e,null,[[0,12]])}));return function(){return S.apply(this,arguments)}}(),Re=function(e){var o,a={INIT:"INIT"},m=a.INIT,s=(0,Z.useState)([]),g=(0,I.Z)(s,2),u=g[0],v=g[1],j=(0,Z.useState)([]),R=(0,I.Z)(j,2),Te=R[0],G=R[1],Ee=(0,Z.useState)([]),W=(0,I.Z)(Ee,2),Q=W[0],J=W[1],pe=(0,Z.useState)(""),X=(0,I.Z)(pe,2),M=X[0],we=X[1],ke=(0,Z.useState)(void 0),q=(0,I.Z)(ke,2),D=q[0],K=q[1],Le=(0,Z.useState)([]),_=(0,I.Z)(Le,2),ee=_[0],N=_[1],te=(0,Z.useRef)(),Ke=[{title:"id",dataIndex:"id",key:"id",hideInSearch:!0,hideInTable:!0},{title:"Name",dataIndex:"name",key:"name"},{title:"Code",dataIndex:"code",key:"code",hideInSearch:!0},{title:"Method",dataIndex:"method",key:"method",hideInSearch:!0,filters:!0,onFilter:!0,valueType:"select",valueEnum:{ALL:{text:"ALL"},GET:{text:"GET"},POST:{text:"POST"},HEAD:{text:"HEAD"},PUT:{text:"PUT"},PATCH:{text:"PATCH"},DELETE:{text:"DELETE"},OPTIONS:{text:"OPTIONS"},TRACE:{text:"TRACE"}}},{title:"Path",dataIndex:"path",key:"path",hideInSearch:!0,ellipsis:!0}],Fe=function(){var d=(0,F.Z)(A().mark(function i(r,l,h){var C,b,w,V,U,ae,k;return A().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(C=D==null?void 0:D.id,!C){f.next=17;break}return b=r,l&&(w=Object.keys(l)[0],V=Object.values(l)[0],w&&V&&(b=(0,c.Z)((0,c.Z)({},b),{},{sortField:w,sort:V==="ascend"?"asc":"desc"}))),f.prev=4,ae=e==null||(U=e.assignPermissionRole)===null||U===void 0?void 0:U.id,f.next=8,(0,P.Pu)((0,c.Z)((0,c.Z)({},b),{},{rootId:C,roleId:ae}));case 8:if(k=f.sent,k.code!==200){f.next=12;break}if(!k.results){f.next=12;break}return f.abrupt("return",{data:k.results,success:!0,total:k.count});case 12:f.next=17;break;case 14:return f.prev=14,f.t0=f.catch(4),f.abrupt("return",{});case 17:return f.abrupt("return",{data:[],success:!0,total:0});case 18:case"end":return f.stop()}},i,null,[[4,14]])}));return function(r,l,h){return d.apply(this,arguments)}}(),Oe=function d(i,r){i.push(r.key),r.children&&r.children.forEach(function(l){d(i,l)})},Me=function d(i,r){var l;return r.forEach(function(h){h.children&&(h.children.some(function(C){return C.key===i})?l=h.key:d(i,h.children)&&(l=d(i,h.children)))}),l};(0,Z.useLayoutEffect)(function(){je().then(function(d){d.length>0&&v(d);var i=[];d.forEach(function(r){Oe(i,r)}),G(i)})},[m]);var Ne=function(i){var r=[];return i.forEach(function(l){(l.type===0||l.type===1)&&r.push(l.id)}),r},Ve=function(i){J(i),K(void 0)};e.onRef&&e.onRef(function(d){J(Ne(d)),K(void 0)});var Ue=function(){var i;(0,P.FK)({roleId:e==null||(i=e.assignPermissionRole)===null||i===void 0?void 0:i.id,ids:Q}).then(function(r){r.code===200?y.default.success("Update Role Permission Successful"):y.default.error("Update Role Permission Failure"),e.close()})},Be=function(){var i;(0,P.yC)({roleId:e==null||(i=e.assignPermissionRole)===null||i===void 0?void 0:i.id,rootId:D==null?void 0:D.id,ids:ee}).then(function(r){r.code===200?y.default.success("Update Role Function Successful"):y.default.error("Update Role Function Failure")})},$e=function d(i,r,l){if(l.title.toLocaleLowerCase().indexOf(r)>-1){var h=Me(l.key,u);h&&i.push(h)}l.children&&l.children.forEach(function(C){d(i,r,C)})},He=function(i){var r=[];i.forEach(function(l){l.selected===1&&r.push(l.id)}),N(r)},Ye=function(i){var r=i.target.value,l=[];u.forEach(function(h){$e(l,r.toLocaleLowerCase(),h)}),G(l),we(r)},ze=function d(i){return i.map(function(r){var l=r.title.toLocaleLowerCase().indexOf(M.toLocaleLowerCase()),h=l>-1?function(){var C=r.title.substr(0,l),b=r.title.substr(l+M.length),w=r.title.substring(l,l+M.length);return(0,t.jsxs)("span",{children:[C,(0,t.jsx)("span",{className:z().treeSearchValue,children:w}),b]})}:function(){return(0,t.jsx)("span",{children:r.title})};return r.children?(0,c.Z)((0,c.Z)({},r),{},{title:h,children:d(r.children)}):(0,c.Z)((0,c.Z)({},r),{},{title:h})})};return(0,t.jsx)(Y.Z,{visible:e.visible,title:"Assign ".concat(e==null||(o=e.assignPermissionRole)===null||o===void 0?void 0:o.name," Permission"),width:800,onClose:function(){e.close()},footer:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(x.Z,{onClick:function(){e.close()},children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:Ue,type:"primary",children:"Submit"})]}),bodyStyle:{paddingBottom:80},closable:!0,maskClosable:!0,destroyOnClose:!0,children:(0,t.jsxs)(O.Z,{gutter:24,children:[(0,t.jsxs)(T.Z,{span:8,children:[(0,t.jsx)(Ce,{style:{marginBottom:8},placeholder:"Search",onChange:Ye}),(0,t.jsx)(Se.Z,{checkable:!0,showLine:!0,treeData:ze(u),expandedKeys:Te,autoExpandParent:!0,checkedKeys:Q,onCheck:Ve,onSelect:function(i,r){r.selected?(K(r.node),N([]),te.current.reload()):K(void 0)}})]}),(0,t.jsx)(T.Z,{span:16,children:(0,t.jsx)(Ze.ZP,{defaultSize:"small",className:z().tableBorder,style:{display:D?"block":"none"},headerTitle:"Function List",actionRef:te,rowKey:"id",search:!1,rowSelection:{alwaysShowAlert:!0,selectedRowKeys:ee,preserveSelectedRowKeys:!1,onChange:function(i){N(i)}},onLoad:function(i){He(i)},options:!1,request:Fe,columns:Ke,toolBarRender:function(){return[(0,t.jsx)(x.Z,{type:"primary",onClick:Be,children:"Save"},"primary")]}})})]})})},De=Re,Ae=function(){var S=(0,F.Z)(A().mark(function e(o){var a;return A().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,P.xi)({roleId:o});case 3:if(a=s.sent,a.code!==200){s.next=8;break}if(!a.results){s.next=7;break}return s.abrupt("return",a.results);case 7:return s.abrupt("return",[]);case 8:s.next=13;break;case 10:return s.prev=10,s.t0=s.catch(0),s.abrupt("return",[]);case 13:return s.abrupt("return",[]);case 14:case"end":return s.stop()}},e,null,[[0,10]])}));return function(o){return S.apply(this,arguments)}}(),Ie=function(S){(0,ie.Z)(o,S);var e=(0,le.Z)(o);function o(){var a;(0,se.Z)(this,o);for(var m=arguments.length,s=new Array(m),g=0;g<m;g++)s[g]=arguments[g];return a=e.call.apply(e,[this].concat(s)),a.state={showAssignPermission:!1,assignPermissionRole:void 0,showAdd:!1,drawerData:{},tableData:[],tablePagination:{},loading:!1},a.setCheckedItem=void 0,a.loadData=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};a.setState({loading:!0}),(0,P.Uy)((0,c.Z)({results:10},u)).then(function(v){var j=a.state.tablePagination;j.total=v.count,a.setState({loading:!1,tablePagination:j,tableData:v.results})})},a.handleTableChange=function(u,v,j){var R=a.state.pager;R.current=u.current,a.setState({tablePagination:R}),a.loadData((0,c.Z)({results:u.pageSize,page:u.current,sortField:j.field,sortOrder:j.order},v))},a.del=function(u){var v=ne.Z.confirm;v({title:"Delete Permission",content:(0,t.jsx)(t.Fragment,{children:"Please confirm delete action"}),okText:"Confirm",onOk:function(){(0,P.Rd)({id:u}).then(function(R){R.code===200?y.default.success("Delete Role Successful"):y.default.error("Delete Role Failure"),a.setState({drawerData:{},showAdd:!1}),a.loadData({})})}})},a.edit=function(u){a.setState({drawerData:u,showAdd:!0})},a.add=function(){a.setState({drawerData:{},showAdd:!0})},a.submit=function(u){u.id?(0,P.ul)((0,c.Z)({},u)).then(function(v){v.code===200?y.default.success("Update Role Successful"):y.default.error("Update Role Failure"),a.setState({showAdd:!1}),a.loadData({})}):(0,P.fA)((0,c.Z)({},u)).then(function(v){v.code===200?y.default.success("Add Role Successful"):y.default.error("Add Role Failure"),a.setState({showAdd:!1}),a.loadData({})})},a.assignPermission=function(u){Ae(u.id).then(function(v){a.setCheckedItem(v),a.setState({assignPermissionRole:u,showAssignPermission:!0})})},a.onRef=function(u){a.setCheckedItem=u},a}return(0,re.Z)(o,[{key:"componentDidMount",value:function(){this.loadData({})}},{key:"render",value:function(){var m=this;return(0,t.jsxs)(ue.ZP,{children:[(0,t.jsx)(H.Z,{children:(0,t.jsx)(L.Z,{children:(0,t.jsxs)(x.Z,{type:"primary",onClick:this.add,children:[(0,t.jsx)(oe.Z,{}),"Add"]})})}),(0,t.jsx)(H.Z,{children:(0,t.jsx)(me,{dataSource:this.state.tableData,pagination:this.state.tablePagination,loading:this.state.loading,edit:this.edit,assignPermission:this.assignPermission})}),(0,t.jsx)(ye,{setShowAdd:function(){m.setState({showAdd:!1})},visible:this.state.showAdd,delete:this.del,drawerData:this.state.drawerData,onSubmit:this.submit}),(0,t.jsx)(De,{visible:this.state.showAssignPermission,close:function(){m.setState({showAssignPermission:!1,assignPermissionRole:void 0,checkedPermissionRole:[]})},assignPermissionRole:this.state.assignPermissionRole,checkedPermissionRole:this.state.checkedPermissionRole,onRef:this.onRef})]})}}]),o}(Z.Component),be=Ie}}]);
