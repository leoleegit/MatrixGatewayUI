(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[597],{416:function(U){U.exports={main:"main___27Qvg",treeSearchValue:"treeSearchValue___3qwWj",tableBorder:"tableBorder___MFgVb"}},19693:function(U,B,n){"use strict";n.r(B),n.d(B,{default:function(){return Ae}});var Ye=n(58024),$=n(39144),ze=n(49111),L=n(19650),Ge=n(57663),x=n(71577),We=n(34792),S=n(48086),Qe=n(71194),te=n(5644),f=n(8870),ae=n(69610),ne=n(54941),se=n(81306),re=n(19809),F=n(3182),ie=n(94043),A=n.n(ie),P=n(67294),le=n(49101),de=n(70844),Je=n(66456),oe=n(55178),ue=n(30381),ce=n.n(ue),t=n(85893),fe=function(e){var o=[{title:"Name",dataIndex:"name",key:"name"},{title:"Code",dataIndex:"code",key:"code"},{title:"Description",dataIndex:"desc",key:"desc"},{title:"Updated At",dataIndex:"updatedAt",key:"updatedAt",valueType:"dateTime",render:function(g,s){return(0,t.jsx)(t.Fragment,{children:new(ce())(new Date(s.updatedAt)).format("YYYY-MM-DD HH:mm")})}},{title:"Action",key:"Action",render:function(g,s){return(0,t.jsxs)(L.Z,{size:"middle",children:[(0,t.jsx)("a",{onClick:function(){e.edit(s)},children:"Edit"}),(0,t.jsx)("a",{onClick:function(){e.assignPermission(s)},children:"Assign Permission"})]})}}];return(0,t.jsx)(oe.Z,{rowKey:"id",columns:o,dataSource:e.dataSource,pagination:e.pagination,loading:e.loading,onChange:e.handleTableChange})},he=fe,Xe=n(57338),H=n(25084),qe=n(13062),O=n(71230),_e=n(89032),T=n(15746),et=n(9715),E=n(82482),tt=n(47673),p=n(4107),ve=function(e){var o=function(){e.setShowAdd(!1)};return(0,t.jsx)(H.Z,{visible:e.visible,title:"Role",width:720,onClose:function(){e.setShowAdd(!1)},bodyStyle:{paddingBottom:80},footer:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(x.Z,{onClick:o,children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:function(){document.getElementById("form-id").click()},type:"primary",children:"Submit"}),e.drawerData.id&&(0,t.jsx)(x.Z,{onClick:function(){e.delete(e.drawerData.id)},type:"danger",children:"Delete"})]}),closable:!1,maskClosable:!1,destroyOnClose:!0,children:(0,t.jsxs)(E.Z,{initialValues:e.drawerData,layout:"vertical",hideRequiredMark:!0,onFinish:e.onSubmit,children:[(0,t.jsxs)(O.Z,{gutter:16,children:[(0,t.jsx)(T.Z,{span:12,children:(0,t.jsx)(E.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter role name"}],children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.name,placeholder:"Please enter role name"})})}),(0,t.jsx)(T.Z,{span:12,children:(0,t.jsx)(E.Z.Item,{name:"code",label:"Role Code",rules:[{required:!0,message:"Please enter role code"}],children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.code,placeholder:"Please enter role code",disabled:!!e.drawerData.code})})})]}),(0,t.jsx)(O.Z,{gutter:16,children:(0,t.jsx)(T.Z,{span:24,children:(0,t.jsx)(E.Z.Item,{name:"desc",label:"Description",rules:[{required:!0,message:"please enter role description"}],children:(0,t.jsx)(p.Z.TextArea,{rows:2,defaultValue:e.drawerData.desc,placeholder:"please enter role description"})})})}),(0,t.jsx)(E.Z.Item,{name:"id",children:(0,t.jsx)(p.Z,{defaultValue:e.drawerData.id,style:{display:"none"}})}),(0,t.jsx)(x.Z,{id:"form-id",type:"primary",htmlType:"submit",style:{display:"none"},children:"Submit"})]})})},me=ve,at=n(32157),ge=n(87524),I=n(2824),ye=n(20851),C=n(2442),Se=n(416),Y=n.n(Se),Ze=p.Z.Search,Pe=function Z(e){if(e.children){var o=[];return e.children.forEach(function(a){o.push(Z(a))}),(0,f.Z)((0,f.Z)({},e),{},{key:e.id,title:e.name,children:o})}return(0,f.Z)((0,f.Z)({},e),{},{key:e.id,title:e.name})},Ce=function(){var Z=(0,F.Z)(A().mark(function e(){var o,a;return A().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,C.Lw)({});case 3:if(o=s.sent,o.code!==200){s.next=10;break}if(!o.results){s.next=9;break}return a=[],o.results.forEach(function(y){a.push(Pe(y))}),s.abrupt("return",a);case 9:return s.abrupt("return",[]);case 10:s.next=15;break;case 12:return s.prev=12,s.t0=s.catch(0),s.abrupt("return",[]);case 15:return s.abrupt("return",[]);case 16:case"end":return s.stop()}},e,null,[[0,12]])}));return function(){return Z.apply(this,arguments)}}(),xe=function(e){var o,a={INIT:"INIT"},g=a.INIT,s=(0,P.useState)([]),y=(0,I.Z)(s,2),u=y[0],v=y[1],j=(0,P.useState)([]),R=(0,I.Z)(j,2),Ie=R[0],z=R[1],be=(0,P.useState)([]),G=(0,I.Z)(be,2),W=G[0],Q=G[1],Te=(0,P.useState)(""),J=(0,I.Z)(Te,2),M=J[0],Ee=J[1],pe=(0,P.useState)(void 0),X=(0,I.Z)(pe,2),D=X[0],K=X[1],we=(0,P.useState)([]),q=(0,I.Z)(we,2),_=q[0],N=q[1],ee=(0,P.useRef)(),ke=[{title:"id",dataIndex:"id",key:"id",hideInSearch:!0,hideInTable:!0},{title:"Name",dataIndex:"name",key:"name"},{title:"Code",dataIndex:"code",key:"code",hideInSearch:!0},{title:"Method",dataIndex:"method",key:"method",hideInSearch:!0,filters:!0,onFilter:!0,valueType:"select",valueEnum:{ALL:{text:"ALL"},GET:{text:"GET"},POST:{text:"POST"},HEAD:{text:"HEAD"},PUT:{text:"PUT"},PATCH:{text:"PATCH"},DELETE:{text:"DELETE"},OPTIONS:{text:"OPTIONS"},TRACE:{text:"TRACE"}}},{title:"Path",dataIndex:"path",key:"path",hideInSearch:!0,ellipsis:!0}],Le=function(){var d=(0,F.Z)(A().mark(function i(r,l,c){var m,b,w,V,k;return A().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(m=D==null?void 0:D.id,!m){h.next=16;break}return b=r,l&&(w=Object.keys(l)[0],V=Object.values(l)[0],w&&V&&(b=(0,f.Z)((0,f.Z)({},b),{},{sortField:w,sort:V==="ascend"?"asc":"desc"}))),h.prev=4,h.next=7,(0,C.Pu)((0,f.Z)((0,f.Z)({},b),{},{rootId:m}));case 7:if(k=h.sent,k.code!==200){h.next=11;break}if(!k.results){h.next=11;break}return h.abrupt("return",{data:k.results,success:!0,total:k.count});case 11:h.next=16;break;case 13:return h.prev=13,h.t0=h.catch(4),h.abrupt("return",{});case 16:return h.abrupt("return",{data:[],success:!0,total:0});case 17:case"end":return h.stop()}},i,null,[[4,13]])}));return function(r,l,c){return d.apply(this,arguments)}}(),Ke=function d(i,r){i.push(r.key),r.children&&r.children.forEach(function(l){d(i,l)})},Fe=function d(i,r){var l;return r.forEach(function(c){c.children&&(c.children.some(function(m){return m.key===i})?l=c.key:d(i,c.children)&&(l=d(i,c.children)))}),l};(0,P.useLayoutEffect)(function(){Ce().then(function(d){d.length>0&&v(d);var i=[];d.forEach(function(r){Ke(i,r)}),z(i)})},[g]);var Oe=function(i){var r=[];return i.forEach(function(l){(l.type===0||l.type===1)&&r.push(l.id)}),r},Me=function(i){Q(i),K(void 0)};e.onRef&&e.onRef(function(d){Q(Oe(d)),K(void 0)});var Ne=function(){var i;(0,C.FK)({roleId:e==null||(i=e.assignPermissionRole)===null||i===void 0?void 0:i.id,ids:W}).then(function(r){r.code===200?S.default.success("Update Role Permission Successful"):S.default.error("Update Role Permission Failure"),e.close()})},Ve=function(){var i;(0,C.yC)({roleId:e==null||(i=e.assignPermissionRole)===null||i===void 0?void 0:i.id,rootId:D==null?void 0:D.id,ids:_}).then(function(r){r.code===200?S.default.success("Update Role Function Successful"):S.default.error("Update Role Function Failure")})},Ue=function d(i,r,l){if(l.title.toLocaleLowerCase().indexOf(r)>-1){var c=Fe(l.key,u);c&&i.push(c)}l.children&&l.children.forEach(function(m){d(i,r,m)})},Be=function(i){var r,l=[],c=e==null||(r=e.assignPermissionRole)===null||r===void 0?void 0:r.id;i.forEach(function(m){m.roleId===c&&l.push(m.id)}),N(l)},$e=function(i){var r=i.target.value,l=[];u.forEach(function(c){Ue(l,r.toLocaleLowerCase(),c)}),z(l),Ee(r)},He=function d(i){return i.map(function(r){var l=r.title.toLocaleLowerCase().indexOf(M.toLocaleLowerCase()),c=l>-1?function(){var m=r.title.substr(0,l),b=r.title.substr(l+M.length),w=r.title.substring(l,l+M.length);return(0,t.jsxs)("span",{children:[m,(0,t.jsx)("span",{className:Y().treeSearchValue,children:w}),b]})}:function(){return(0,t.jsx)("span",{children:r.title})};return r.children?(0,f.Z)((0,f.Z)({},r),{},{title:c,children:d(r.children)}):(0,f.Z)((0,f.Z)({},r),{},{title:c})})};return(0,t.jsx)(H.Z,{visible:e.visible,title:"Assign ".concat(e==null||(o=e.assignPermissionRole)===null||o===void 0?void 0:o.name," Permission"),width:800,onClose:function(){e.close()},footer:(0,t.jsxs)(L.Z,{children:[(0,t.jsx)(x.Z,{onClick:function(){e.close()},children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:Ne,type:"primary",children:"Submit"})]}),bodyStyle:{paddingBottom:80},closable:!0,maskClosable:!0,destroyOnClose:!0,children:(0,t.jsxs)(O.Z,{gutter:24,children:[(0,t.jsxs)(T.Z,{span:8,children:[(0,t.jsx)(Ze,{style:{marginBottom:8},placeholder:"Search",onChange:$e}),(0,t.jsx)(ge.Z,{checkable:!0,showLine:!0,treeData:He(u),expandedKeys:Ie,autoExpandParent:!0,checkedKeys:W,onCheck:Me,onSelect:function(i,r){r.selected?(K(r.node),N([]),ee.current.reload()):K(void 0)}})]}),(0,t.jsx)(T.Z,{span:16,children:(0,t.jsx)(ye.ZP,{defaultSize:"small",className:Y().tableBorder,style:{display:D?"block":"none"},headerTitle:"Function List",actionRef:ee,rowKey:"id",search:!1,rowSelection:{alwaysShowAlert:!0,selectedRowKeys:_,preserveSelectedRowKeys:!1,onChange:function(i){N(i)}},onLoad:function(i){Be(i)},options:!1,request:Le,columns:ke,toolBarRender:function(){return[(0,t.jsx)(x.Z,{type:"primary",onClick:Ve,children:"Save"},"primary")]}})})]})})},je=xe,Re=function(){var Z=(0,F.Z)(A().mark(function e(o){var a;return A().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,C.xi)({roleId:o});case 3:if(a=s.sent,a.code!==200){s.next=8;break}if(!a.results){s.next=7;break}return s.abrupt("return",a.results);case 7:return s.abrupt("return",[]);case 8:s.next=13;break;case 10:return s.prev=10,s.t0=s.catch(0),s.abrupt("return",[]);case 13:return s.abrupt("return",[]);case 14:case"end":return s.stop()}},e,null,[[0,10]])}));return function(o){return Z.apply(this,arguments)}}(),De=function(Z){(0,se.Z)(o,Z);var e=(0,re.Z)(o);function o(){var a;(0,ae.Z)(this,o);for(var g=arguments.length,s=new Array(g),y=0;y<g;y++)s[y]=arguments[y];return a=e.call.apply(e,[this].concat(s)),a.state={showAssignPermission:!1,assignPermissionRole:void 0,showAdd:!1,drawerData:{},tableData:[],tablePagination:{},loading:!1},a.setCheckedItem=void 0,a.loadData=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};a.setState({loading:!0}),(0,C.Uy)((0,f.Z)({results:10},u)).then(function(v){var j=a.state.tablePagination;j.total=v.count,a.setState({loading:!1,tablePagination:j,tableData:v.results})})},a.handleTableChange=function(u,v,j){var R=a.state.pager;R.current=u.current,a.setState({tablePagination:R}),a.loadData((0,f.Z)({results:u.pageSize,page:u.current,sortField:j.field,sortOrder:j.order},v))},a.del=function(u){var v=te.Z.confirm;v({title:"Delete Permission",content:(0,t.jsx)(t.Fragment,{children:"Please confirm delete action"}),okText:"Confirm",onOk:function(){(0,C.Rd)({id:u}).then(function(R){R.code===200?S.default.success("Delete Role Successful"):S.default.error("Delete Role Failure"),a.setState({drawerData:{},showAdd:!1}),a.loadData({})})}})},a.edit=function(u){a.setState({drawerData:u,showAdd:!0})},a.add=function(){a.setState({drawerData:{},showAdd:!0})},a.submit=function(u){u.id?(0,C.ul)((0,f.Z)({},u)).then(function(v){v.code===200?S.default.success("Update Role Successful"):S.default.error("Update Role Failure"),a.setState({showAdd:!1}),a.loadData({})}):(0,C.fA)((0,f.Z)({},u)).then(function(v){v.code===200?S.default.success("Add Role Successful"):S.default.error("Add Role Failure"),a.setState({showAdd:!1}),a.loadData({})})},a.assignPermission=function(u){Re(u.id).then(function(v){a.setCheckedItem(v),a.setState({assignPermissionRole:u,showAssignPermission:!0})})},a.onRef=function(u){a.setCheckedItem=u},a}return(0,ne.Z)(o,[{key:"componentDidMount",value:function(){this.loadData({})}},{key:"render",value:function(){var g=this;return(0,t.jsxs)(de.ZP,{children:[(0,t.jsx)($.Z,{children:(0,t.jsx)(L.Z,{children:(0,t.jsxs)(x.Z,{type:"primary",onClick:this.add,children:[(0,t.jsx)(le.Z,{}),"Add"]})})}),(0,t.jsx)($.Z,{children:(0,t.jsx)(he,{dataSource:this.state.tableData,pagination:this.state.tablePagination,loading:this.state.loading,edit:this.edit,assignPermission:this.assignPermission})}),(0,t.jsx)(me,{setShowAdd:function(){g.setState({showAdd:!1})},visible:this.state.showAdd,delete:this.del,drawerData:this.state.drawerData,onSubmit:this.submit}),(0,t.jsx)(je,{visible:this.state.showAssignPermission,close:function(){g.setState({showAssignPermission:!1,assignPermissionRole:void 0,checkedPermissionRole:[]})},assignPermissionRole:this.state.assignPermissionRole,checkedPermissionRole:this.state.checkedPermissionRole,onRef:this.onRef})]})}}]),o}(P.Component),Ae=De}}]);
